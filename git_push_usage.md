# GitHub推送功能使用说明

## 功能概述
GitHub推送功能允许您将当前编辑的sites.csv和categories.csv文件直接推送到指定的GitHub仓库，支持自定义仓库地址、分支名称、目标文件夹和提交信息。

## 使用方法

### 使用方法

### 1. 打开推送对话框
点击程序界面上的 **"推送Git"** 按钮，打开推送对话框。

### 2. 填写仓库信息
- **仓库地址**: 输入GitHub仓库地址，支持以下格式：
  - `https://github.com/用户名/仓库名.git`
  - `https://github.com/用户名/仓库名/`
  - `git@github.com:用户名/仓库名.git`
  - **注意**：请确保地址格式正确，不要包含多余的引号或空格
  - **程序会自动清理地址中的特殊字符**

  **地址格式要求**：
  ```
  ✅ 正确格式：
  https://github.com/用户名/仓库名.git
  https://github.com/用户名/仓库名/
  git@github.com:用户名/仓库名.git
  
  ❌ 错误格式：
  `https://github.com/用户名/仓库名.git`（包含反引号）
  "https://github.com/用户名/仓库名.git"（包含引号）
  ```

### 3. 设置分支（可选）
- **分支名称**: 默认为 `main`，可以根据需要修改为其他分支名称

### 4. 指定目标文件夹（可选）
- **目标文件夹**: 可以指定将CSV文件推送到仓库中的特定文件夹
  - 例如：`data/` - 将文件推送到仓库的data文件夹中
  - 留空则推送到仓库根目录

### 5. 输入提交信息
在提交信息文本框中输入本次更新的说明，默认为当前时间戳。

### 6. 开始推送
点击 **"开始推送"** 按钮，程序会自动：
1. 保存当前编辑的数据
2. 检查并初始化Git仓库
3. 配置远程仓库地址
4. 设置Git用户信息
5. 创建初始提交（如需要）
6. 拉取远程分支最新代码（如果存在）
7. 添加文件到暂存区
8. 提交变更
9. 推送到远程仓库

推送进度会实时显示在对话框的进度区域。

## 使用示例

### 推送到仓库根目录
- 仓库地址：`https://github.com/yourname/your-repo.git`
- 目标文件夹：留空
- 结果：文件将位于 `your-repo/sites.csv` 和 `your-repo/categories.csv`

### 推送到特定文件夹
- 仓库地址：`https://github.com/zm0410/cangshuqian.git`
- 目标文件夹：`data/`
- 结果：文件将位于 `cangshuqian/data/sites.csv` 和 `cangshuqian/data/categories.csv`

## 首次使用注意事项

### 1. GitHub Personal Access Token
首次推送到GitHub仓库时，可能需要配置Personal Access Token：
1. 访问 GitHub Settings > Developer settings > Personal access tokens
2. 创建新的Token，勾选 `repo` 权限
3. 在推送时输入用户名和Token作为密码

### 2. 网络连接
确保网络连接正常，能够访问GitHub。

### 3. 仓库权限
确保您有权限推送代码到目标仓库。

## 错误处理

推送失败时，程序会提供详细的错误信息和解决方案：
- **权限被拒绝**: 检查GitHub访问权限和Token设置
- **认证失败**: 验证用户名和密码/Token是否正确
- **需要拉取最新代码**: 远程仓库有更新，先拉取再推送
- **网络连接问题**: 检查网络连接状态
- **分支不存在**: 程序会自动创建新分支
- **没有初始提交**: 程序会自动创建初始提交

1. **"src refspec main does not match any"**
   - 原因：Git仓库没有初始提交
   - 解决方案：程序会自动创建初始提交

2. **"remote add origin" 失败**
   - 原因：仓库地址格式错误或包含非法字符
   - 解决方案：检查仓库地址，确保格式正确，不要包含引号等特殊字符
   - 正确格式：`https://github.com/用户名/仓库名.git`
   - 错误格式：`"https://github.com/用户名/仓库名.git"`（注意引号）

## 功能特点

- ✅ 支持多种GitHub仓库地址格式
- ✅ 自动初始化Git仓库
- ✅ 智能配置Git用户信息
- ✅ 支持自定义分支名称
- ✅ 支持推送到指定文件夹
- ✅ 自动处理初始提交
- ✅ 实时显示推送进度
- ✅ 详细的错误诊断和解决方案
- ✅ 线程安全的推送操作
- ✅ 自动清理临时文件

## 技术细节

当指定目标文件夹时，程序会：
1. 创建临时工作目录
2. 在临时目录中初始化Git仓库
3. 创建指定的文件夹结构
4. 将CSV文件复制到目标文件夹
5. 执行Git操作并推送
6. 自动清理临时文件

这种方式确保不会干扰您当前的工作目录，同时能够精确控制推送的文件位置。